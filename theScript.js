!function(){function a(a,t){this.v={x:0,y:0},this.vR=Math.PI,this.vRstop=0,this.vRPrevia=this.vR,this.maxV=.15,this.incVr=Math.PI/6,this.ang=0,this.x=0,this.y=0,this.anterior_pos={x:0,y:0},this.r=c,this.planeta=null,this.planetaAnt=null,this.planetaRechazado=null,this.noTragar=null,this.gravedad=!1,this.planetLover=0,this.viva=!0,this.maxvidas=4,this.vidas=this.maxvidas,this.color=a,this.jugador=t,this.jugador&&this.jugador.asignarBola(this)}function t(a,e,i){this.bolas=0,this.muertes=0,this.tiempo=0,this.color=a,this.controlId=e,this.secondControlId=i,this.ultimaMuerte=0,this.noRepetirSonidos={},this.id=t.ultId++}a.prototype.salirOrb=function(){if(this.planeta){var a=this.vR*this.planeta.rg,t={x:this.planeta.y-this.y,y:this.x-this.planeta.x},e=ca(t.x,t.y);t.x=t.x/e,t.y=t.y/e,this.v.x=t.x*a,this.v.y=t.y*a,this.planetaAnt=this.planeta,this.planetaRechazado=this.planeta,this.planeta.bolas.splice(this.planeta.bolas.indexOf(this),1),this.planeta=null,ma(pa.cambio)}},a.prototype.damage=function(a,t,e){if(!(a.bolas.length<2||a.modo===u.CENTRO&&this.jugador))if(this.salvado)this.salvado=!1;else{this.vidas--;var i=Math.floor((this.vidas-.3)/(this.maxvidas-.3)*255);if(this.color="rgb("+i+","+i+","+i+")",!e&&this.vidas>0)return this.jugador?G.nuevaNota(this.vidas+" li"+(this.vidas>1?"ves":"fe")+" left",this.jugador):G.nuevaNota(this.vidas+" li"+(this.vidas>1?"ves":"fe")+" left"),void(this.planetaAnt=null);if(this.viva=!1,pa.muerte.currentTime=0,pa.muerte.play(),this.jugador){for(var o in G.nuevaNota(t,this.jugador),this.jugador.bolas--,this.jugador.muertes++,this.jugador.ultimaMuerte=Date.now()-a.inicioPartida,a.bolas)if(!a.bolas[o].jugador){a.bolas[o].jugador=this.jugador,this.jugador.bolas++;break}a.bolas.splice(a.bolas.indexOf(this),1);var n=0,r=null;for(o in a.jugadores)if(a.jugadores[o].bolas>0&&(r=a.jugadores[o],++n>1))return;a.finalizar(r)}else a.bolas.splice(a.bolas.indexOf(this),1)}},a.prototype.updateEnOrbita=function(a){if(N&&N.stopEffect&&N.stopper!==this)return this.vRstop=0===this.vR?this.vRstop:this.vR,void(this.vR=0);0!==this.vRstop&&(this.vR=this.vRstop,this.vRstop=0);var t=Math.random();this.vRPrevia=this.vR,Math.abs(this.vR*this.planeta.rg)<b&&(this.vR+=(this.vR>0?1:-1)*t*this.incVr*a),this.ang+=this.vR*a,Math.abs(this.ang)>2*Math.PI&&(this.ang-=2*Math.PI*ua(this.ang)),this.x=this.planeta.x+this.planeta.rg*Math.cos(this.ang),this.y=this.planeta.y+this.planeta.rg*Math.sin(this.ang);var e=Math.abs(this.vR/this.planeta.rg);e<this.maxV&&(this.vR+=t*this.incVr*a*ua(this.vR)),e>this.maxV/2&&(this.vR-=t*this.incVr*a*ua(this.vR)*.9),e>1.5*this.maxV&&(this.vR*=.8),this.jugador&&z[this.jugador.secondControlId]&&(this.vR*=.95)},t.ultId=1,t.prototype.asignarBola=function(){this.bolas++};var e=[["Invincible",20],["Speed up x 2",30],["Speed down",40],["Out of the orbit!",150],["Invisible",180],["Useless asteroid",210],["Rebound!",150],["Lucky",30],["Own gravity",30],["Speed up",180],["Lifesaver",210],["Transport",180],["Reproductive",20],["Changing roles",10],["Stop",5],["Planet lover",40],["A Present",25],["Blind",10],["Speed down x 2",30],["Another chance",20]],i=0;for(var o in e)i+=parseInt(e[o][1]),e[o][1]=i;function n(a,t){this.x=a,this.y=t;var o=Math.random();this.duracion=2e3+8e3*o;var n=Math.floor(o*i);for(var r in e)if(parseInt(e[r][1])>=n){this.tipo=parseInt(r);break}}function r(a,t,e,i,o){this.x=a,this.y=t,this.r=e,this.centro=o,this.centro&&(this.mayor_t=0,this.mayor_t_j=null),this.bolas=[];var n=Math.random();if(this.n_imagen=Math.floor(n*j),this.ang=10*n,this.vel=(.001+.009*n)*Math.pow(-1,Math.floor(10*n)),this.rotarEn=0,this.cargarImagen(),this.renderizado=null,this.rg=i,this.nodisponible=0,this.radioVariable=!o&&1e3*n<100,this.radioVariable&&(this.rr=i,this.rv=1,this.crece=!1),this.r<35&&Math.random()<I){this.inquieto=!0,this.movingV=10+20*Math.random(),this.dir={x:2*Math.random()-1,y:2*Math.random()-1};var r=ca(this.dir.x,this.dir.y);this.dir.x/=r,this.dir.y/=r}}function s(a,t,e,i,o,n,r,s){this.modo=void 0!==t&&function(a){for(var t in u)if(u.hasOwnProperty(t)&&u[t]===a)return!0;return!1}(t)?t:u.CLASICO,this.maxPlanetas=e>0?e:a.length+i,this.numBolasExtra=i,this.bolasXjugador=s&&s>0?s:1,this.maxAgujeros=n>0?n:0,this.duracion=o,this.agujerosInofensivos=r,this.jugadores=a,this.bolas=[],this.agujeros=[],this.planetas=[],this.planetasND=[],this.planetasRV=[],this.asteroides=[],this.actualizarParteFija=!0,this.mapaGenerado=!1,this.bolasGeneradas=!1,this.iniciado=!1,this.pausado=!1,this.finalizado=!1,this.apagado=!1,this.inicioPartida=0,this.then=0,this.stopEffect=0,this.stopper=null,this.blindGame=0}n.prototype.hacerEfecto=function(a){var t=[0,1,4,8,9,10,11];switch(a.fortuna&&(this.tipo=t[Math.floor(Math.random()*t.length)]),14!==this.tipo||a.jugador||(this.tipo=3),this.tipo){case 0:a.invencible=!0,a.invencibleTime=this.duracion;break;case 1:a.vR*=1.75,a.v.x*=1.75,a.v.y*=1.75;break;case 2:a.vR*=.5,a.v.x*=.5,a.v.y*=.5;break;case 3:a.salirOrb();break;case 4:a.invisible=!0,a.invisibleTime=this.duracion;break;case 5:break;case 6:a.vR*=-1,a.v.x*=-1,a.v.y*=-1;break;case 7:a.fortuna=!0,a.fortunaTime=10*this.duracion;break;case 8:a.gravedad=!0,a.gravedadTime=5*this.duracion;break;case 9:a.vR*=1.5,a.v.x*=1.5,a.v.y*=1.5;break;case 10:a.salvado=!0;break;case 11:a.transportado=!0;break;case 12:N&&(N.asteroides.push(h(N)),N.asteroides.push(h(N)),N.asteroides.push(h(N)));break;case 13:if(N)for(var i in N.bolas){var o=N.bolas[i].jugador;i=parseInt(i);var n=Math.floor(Math.random()*(N.bolas.length-i))+i;N.bolas[i].jugador=N.bolas[n].jugador,N.bolas[n].jugador=o}ma(pa.dados);break;case 14:N&&(N.stopEffect=Date.now()+this.duracion/2,N.stopper=a);break;case 15:a.planetLover=this.duracion+1e3;break;case 16:N&&N.generarBola(a.jugador,[]);break;case 17:N&&(N.blindGame=this.duracion);break;case 18:a.vR*=.25,a.v.x*=.25,a.v.y*=.25;break;case 19:N&&N.generarBola(null,[]);break;default:console.log("Asteroide tipo [",this.tipo,"] DESCONOCIDO.",this)}a.jugador?G.nuevaNota(e[this.tipo][0],a.jugador):G.nuevaNota(e[this.tipo][0])},r.prototype.update=function(a){if(this.radioVariable&&(this.crece?this.rv+=.001:this.rv-=.001,this.rv<=.75&&(this.rv=.75,this.crece=!0),this.rv>=1&&(this.rv=1,this.crece=!1),this.rg=this.rr*this.rv),this.inquieto){this.dir.x+=.1*Math.random()-.05,this.dir.y+=.1*Math.random()-.05;var t=ca(this.dir.x,this.dir.y);this.dir.x*=this.movingV*a/t,this.dir.y*=this.movingV*a/t;var e=!0,i=(this.radioVariable?this.rr:this.rg)+2*c,o=this.y+this.dir.y,n=this.x+this.dir.x;if(n>i&&n<C.w-i&&o>i&&o<C.h-i){for(var r in N.planetas){var s=N.planetas[r];if(s!==this){var l=s.radioVariable?s.rr:s.rg;if(ca(s.x-n,s.y-o)<l+i){e=!1;break}}}e?(this.x=n,this.y=o):Math.random()>.5?this.dir.x*=-1:this.dir.y*=-1}}this.bolasUpdate(a)},r.prototype.bolasUpdate=function(a){var t=[];for(var e in this.bolas){var i=this.bolas[e];if(i.updateEnOrbita(a),this.centro&&i.jugador&&t.push(i),(i=this.bolas[e]).jugador&&z[i.jugador.controlId])Math.abs(i.vR*this.rg)>b?i.salirOrb():i.jugador.noRepetirSonidos.cinta||(i.jugador.noRepetirSonidos.cinta=!0,ma(pa.cinta));else if(!i.invisible)for(var o=e;o>=0;o--){var n=this.bolas[o];if(!n.invisible&&n.vRPrevia!==i.vRPrevia){for(var r=i.r+n.r,s=!1,l=0;!s&&l<4;l++)s=ca(i.x-l/4*i.vRPrevia-n.x+l/4*n.vRPrevia,i.y-l/4*i.vRPrevia-n.y+l/4*n.vRPrevia)<r;if(s){if(N&&N.stopEffect)N.stopper===i?(n.vR=i.vR,n.salirOrb()):N.stopper===n&&(i.vR=n.vR,i.salirOrb());else if(i.vR*n.vR<=0){var d=Math.abs(i.vR),h=Math.abs(n.vR);i.vR*=-1,n.vR*=-1,d<=h&&!i.invencible&&(i.vR*=1.35,n.vR*=.85,i.salirOrb()),d>=h&&!n.invencible&&(i.vR*=.85,n.vR*=1.35,n.salirOrb())}else Math.abs(i.vR)<Math.abs(n.vR)?(i.vR=n.vR,n.vR=.85*i.vR,i.invencible||i.salirOrb()):(n.vR=i.vR,i.vR=.85*n.vR,n.invencible||n.salirOrb());ma(pa.pong),i.invencible&&n.salirOrb(),n.invencible&&i.salirOrb();break}}}}if(this.centro&&1===t.length){var u=t[0].jugador;u&&this.centro&&(this.ultimo&&(this.ultimo.ultimo=!1),this.ultimo=u,u.ultimo=!0,u.tiempo+=a,u.tiempo>this.mayor_t&&(this.mayor_t=u.tiempo,this.mayor_t_j=u))}},r.prototype.cargarImagen=function(){var a=this;a.imagen=new Image,a.imagen.src="img/planeta_"+this.n_imagen+".png",a.imagen.onload=function(){a.renderizado=document.createElement("canvas"),a.renderizado.width=2*a.r,a.renderizado.height=2*a.r,a.ctx=a.renderizado.getContext("2d"),a.ctx.save(),a.rotar()}},r.prototype.rotar=function(){this.renderizado&&(this.ctx.clearRect(0,0,2*this.r,2*this.r),this.ctx.save(),this.ctx.translate(this.r,this.r),this.ctx.rotate(this.ang),this.ang=(this.ang+this.vel)%(2*Math.PI),this.ctx.drawImage(this.imagen,-this.r,-this.r,2*this.r,2*this.r),this.ctx.restore()),this.rotarEn=Date.now()+100},s.prototype.start=function(){this.generarMapa(),this.generarBolas(),function(a){for(var t in $={asteroide:oa(10,10,ea),paletaIconos:[]},a.jugadores){var e=a.jugadores[t].color;$.paletaIconos[t]={invencible:oa(215,215,ia,J.invencible,e),invisible:oa(215,215,ia,J.invisible,e),fortuna:oa(215,215,ia,J.fortuna,e),gravedad:oa(215,215,ia,J.gravedad,e),salvador:oa(215,215,ia,J.salvador,e),transporte:oa(215,215,ia,J.transporte,e),planetLover:oa(215,215,ia,J.planetLover,e)}}}(N),this.iniciado=!0,this.finalizado=!1,this.then=Date.now(),this.inicioPartida=this.then,this.mainLoop()},s.prototype.mainLoop=function(){var a=Date.now(),t=a-this.then;if(0===t?(t=1,console.log("delta=0\n")):(A=Math.round(.6*A+400/t),E=A<E?A:E),!this.pausado&&(na(this),!this.finalizado))for(var e in this.physicsUpdate(t/1e3),this.noDisponiblesUpdate(),this.duracion>0&&a-this.inicioPartida>6e4*this.duracion&&this.finalizar(null),a>this.stopEffect&&(this.stopEffect=0,this.stopper=null),this.blindGame>0&&(this.blindGame-=t,this.blindGame<0&&(this.blindGame=0)),G.notas){if(!(G.notas[e].t<a))break;G.notas.splice(parseInt(e),1)}this.then=a;var i=this;this.apagado||requestAnimationFrame(function(){i.mainLoop()})},s.prototype.physicsUpdate=function(a){for(var t in this.planetas){this.planetas[t].update(a)}for(t in this.bolas){var e=this.bolas[t];this.actualizacionAsteroides(e,a),!e.planeta&&e.viva&&(e.anterior_pos={x:e.x,y:e.y},this.bolaLibreUpdate(e,a),e.viva&&(this.bolaColisionBordes(e,a),e.viva&&(this.orbitarPlanetaQuizas(e),e.planetaAnt&&ca(e.x-e.planetaAnt.x,e.y-e.planetaAnt.y)>e.planetaAnt.rg+c&&(e.planetaAnt=null))))}},s.prototype.bolaColisionBordes=function(a,t){(a.x<0||a.x>C.w)&&(a.v.x*=-1,a.x+=a.v.x*t,a.planetaAnt=null,ma(pa.pong2),a.damage(this,"Dead (out of bounds)")),(a.y<0||a.y>C.h)&&(a.v.y*=-1,a.y+=a.v.y*t,a.planetaAnt=null,ma(pa.pong2),a.damage(this,"Dead (out of bounds)"))},s.prototype.orbitarPlanetaQuizas=function(a){var t=this.planetaParaOrbitar(a);if((!a.jugador||!z[a.jugador.controlId])&&t&&!a.planeta){a.planeta=t,t.bolas.push(a);var e=a.x-t.x,i=a.y-t.y;a.ang=Math.atan2(i,e),a.vR=Math.sqrt(a.v.x*a.v.x+a.v.y*a.v.y)/t.rg,e*a.v.y-i*a.v.x<0&&(a.vR*=-1),ma(pa.entrada)}},s.prototype.actualizacionAsteroides=function(a,t){for(var e in this.asteroides){var i=this.asteroides[e];ca(a.x-i.x,a.y-i.y)<a.r+5&&(i.hacerEfecto(a),this.asteroides.splice(parseInt(e),1))}a.invencible&&(a.invencibleTime-=1e3*t,a.invencibleTime<0&&(a.invencible=!1)),a.invisible&&(a.invisibleTime-=1e3*t,a.invisibleTime<0&&(a.invisible=!1)),a.fortuna&&(a.fortunaTime-=1e3*t,a.fortunaTime<0&&(a.fortuna=!1)),a.gravedad&&(a.gravedadTime-=1e3*t,a.gravedadTime<0&&(a.gravedad=!1)),a.planetLover&&(a.planetLover-=1e3*t,a.planetLover<0&&(a.planetLover=0)),this.asteroides.length<x&&1e3*Math.random()<w&&this.asteroides.push(h(this))},s.prototype.planetaParaOrbitar=function(a){for(var t in this.planetas){var e=this.planetas[t];if((!e.nodisponible||a.gravedad)&&a.planetaAnt!==e){var i=ha(a.anterior_pos,a,e);if(i<=e.rg+c&&i>=e.rg-c)return e}}return null},s.prototype.bolaLibreUpdate=function(a,t){if(a.planetLover){var e=0,i=1/0;for(var o in this.planetas)if(this.planetas[o]!==a.planetaRechazado){var n=ca(a.x-this.planetas[o].x,a.y-this.planetas[o].y);n<i&&(e=o,i=n)}var r=ca(a.v.x,a.v.y);a.v.x+=t*r*(this.planetas[e].x-a.x)/i,a.v.y+=t*r*(this.planetas[e].y-a.y)/i}if(a.x+=a.v.x*t,a.y+=a.v.y*t,a.noTragar)l=a.noTragar,(d=ha(a.anterior_pos,a,l))>l.r&&(a.noTragar=null);else for(var s in this.agujeros){var l=this.agujeros[s],d=ha(a.anterior_pos,a,l);if(d<=l.r){if(!this.agujerosInofensivos&&d<=l.c){if(!a.transportado)return void a.damage(this,"Dead (black hole)",!0);var h;a.transportado=!1;do{h=Math.floor(Math.random()*this.agujeros.length)}while(this.agujeros.length>1&&h===s);a.x=this.agujeros[h].x,a.y=this.agujeros[h].y,a.noTragar=this.agujeros[h],a.planetaAnt=null}else(r={x:l.x-a.x,y:l.y-a.y}).x*=t*l.a/ca(r.x,r.y),r.y*=t*l.a/ca(r.x,r.y),a.v.x+=r.x,a.v.y+=r.y;break}}},s.prototype.noDisponiblesUpdate=function(){for(var a in 1e3*Math.random()<M&&this.desactivarOrbitaAleatoria(),this.planetasND)this.planetasND[a].nodisponible-=1,this.planetasND[a].nodisponible<1&&(this.planetasND[a].nodisponible=0,this.planetasND.splice(parseInt(a),0))},s.prototype.desactivarOrbitaAleatoria=function(){var a=Math.floor(Math.random()*this.planetas.length);this.planetas[a].nodisponible||this.planetas[a].centro||(this.planetasND.push(this.planetas[a]),this.planetas[a].nodisponible=500)},s.prototype.finalizar=function(a){switch(G.clear(),this.modo){case u.CLASICO:if(a){G.nuevaNota("Winner: Player "+a.id,a);break}case u.INSTINTO:for(var t=0,e=!0,i=0;i<this.jugadores.length;i++){var o=this.jugadores[i],n=Math.floor(o.ultimaMuerte/6e4),r=Math.floor((o.ultimaMuerte-6e4*n)/1e3),s=Math.floor(o.ultimaMuerte-6e4*n-1e3*r);s<100&&(s="0"+s.toString()),s<10&&(s="00"+s.toString()),G.nuevaNota("Player "+o.id+": "+o.muertes+" deaths. Last one ("+n+"' "+r+'" '+s+")",o),e&&0!==o.muertes&&(e=!1),(o.muertes<this.jugadores[t].muertes||o.muertes===this.jugadores[t].muertes&&o.ultimaMuerte>this.jugadores[t].ultimaMuerte)&&(t=i)}e?G.nuevaNota("Draw!"):G.nuevaNota("Winner: Player "+this.jugadores[t].id,this.jugadores[t]);break;case 2:var l=0;for(i=0;i<this.jugadores.length;i++){var d="Player "+(o=this.jugadores[i]).id+": "+Math.round(100*o.tiempo)/100+" seconds.";o.ultimo&&(d+=" (Last one)"),G.nuevaNota(d,this.jugadores[i]),(o.tiempo>this.jugadores[l].tiempo||o.tiempo===this.jugadores[l].tiempo&&o.ultimo)&&(l=i)}G.nuevaNota("Winner: Player "+this.jugadores[l].id,this.jugadores[l])}this.finalizado=!0,ma(pa.claxon),pa.fondo.pause(),ma(pa.finalizado),q.innerHTML=document.getElementById("restartScreen").innerHTML;var h=q.getElementsByTagName("a");h[0].onclick=U,h[1].onclick=W},s.prototype.generarMapa=function(){if(!this.mapaGenerado){this.mapaGenerado=!0,this.modo===u.CENTRO&&this.planetas.push(new r(C.w/2,C.h/2,g,2*g,!0));for(var a=0;a<this.maxPlanetas;a++){var t=l(p,v,this);if(!t)break;this.planetas.push(t),t.radioVariable&&this.planetasRV.push(t)}for(a=0;a<this.maxAgujeros;a++){var e=d(f,m,y,this);if(!e)break;this.agujeros.push(e)}}},s.prototype.generarBolas=function(){if(!this.bolasGeneradas){this.bolasGeneradas=!0;var a,t=this.planetas.slice(0);if(this.modo===u.CENTRO)for(var e in t)if(t.hasOwnProperty(e)&&t[e].centro){t.splice(parseInt(e),1);break}for(var i in this.jugadores)if(this.jugadores.hasOwnProperty(i))for(a=this.jugadores[i],e=0;e<this.bolasXjugador;e++)this.generarBola(a,t);for(e=0;e<this.numBolasExtra;e++)this.generarBola(null,t)}},s.prototype.generarBola=function(t,e){var i,o=new a("white",t);e.length>0?(i=Math.floor(Math.random()*e.length),o.planeta=e[i],e.splice(i,1)):(i=Math.floor(Math.random()*this.planetas.length),o.planeta=this.planetas[i]),o.planeta.bolas.push(o);var n=Math.pow(-1,Math.round(Math.random()));o.vR=n*(3*Math.PI/4+Math.PI/2*Math.random()),o.vRPrevia=o.vR,o.ang=10*Math.random(),this.bolas.push(o)},s.prototype.puedeRepetirSonidos=function(a){for(var t in this.jugadores)this.jugadores[t].secondControlId!==a&&this.jugadores[t].controlId!==a||(this.jugadores[t].noRepetirSonidos={})},s.prototype.apagar=function(){this.apagado=!0};var l=function(a,t,e){var i,o,n,s,l,d;o=Date.now()+1e3;do{for(var h in d=2.5*(l=1e4*Math.random()%(t-a)+a),i=!0,n=1e4*Math.random()%(C.w-2*(d+c))+d+c,s=1e4*Math.random()%(C.h-2*(d+c))+d+c,e.planetas){var u=e.planetas[h];if(ca(u.x-n,u.y-s)<u.rg+d+2*c){i=!1;break}}}while(!i&&Date.now()<o);return i?new r(n,s,l,d):null},d=function(a,t,e,i){var o,n,r,s,l;o=!1,n=Date.now()+1e3;do{for(var d in o=!0,l=Math.round(Math.random()*(e-t))+t,r=Math.round(Math.random()*(C.w-4*l))+l,s=Math.round(Math.random()*(C.h-4*l))+l,i.planetas){var h=i.planetas[d];if(ca(h.x-r,h.y-s)<h.rg+l+2*c){o=!1;break}}if(o)for(d in i.agujeros){var u=i.agujeros[d];if(ca(u.x-r,u.y-s)<u.r+l+2*c){o=!1;break}}}while(!o&&Date.now()<n);return o?new function(a,t,e,i,o){this.x=a,this.y=t,this.r=e>=i?e:i,this.c=i,this.a=o,this.ang=0}(r,s,l,a,Math.random()*(l/e)*1500+500):null},h=function(a){var t=Math.floor(Math.random()*a.planetas.length);if(a.planetas[t].bolas.length>0){for(var e=(t+1)%a.planetas.length;a.planetas[e].bolas.length>0&&e!==t;)e=(e+1)%a.planetas.length;t=e}var i=Math.floor(2.5*Math.random()*Math.PI);return new n(a.planetas[t].x+a.planetas[t].rg*Math.cos(i),a.planetas[t].y+a.planetas[t].rg*Math.sin(i))};const u={CLASICO:"Classic",INSTINTO:"Instinct",CENTRO:"Center"},c=10,p=30,v=50,g=70,f=10,m=50,y=70,b=200,x=20,w=.08,M=1,I=.004,j=17;const R=800,k=600,C={h:974,w:1920};C.ar=C.w/C.h;var P={w:1,h:1,update:!0},S=!1,A=60,E=1/0,T=null,B=null,O=null,L=null,N=null;var z={},_=!1;addEventListener("keydown",function(a){if(z[a.keyCode]=!0,77===a.keyCode)ba();else if(82===a.keyCode)N&&N.iniciado&&!N.pausado&&!N.apagado&&U();else if(70===a.keyCode)_?(D(),_=!1):(F(document.body),_=!0);else if(27===a.keyCode)_&&D();else if(76===a.keyCode)S=!S;else if(116===a.keyCode||122===a.keyCode)return!0;if(!N||N.finalizado||N.pausado||!N.iniciado)return!0;var t=a||window.event;return t.preventDefault&&t.preventDefault(),t.returnValue=!1,!1},!1),addEventListener("keyup",function(a){delete z[a.keyCode],N&&N.puedeRepetirSonidos(a.keyCode)},!1);var F=function(a){a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.msRequestFullscreen?a.msRequestFullscreen():console.log("Fullscreen API is not supported.")},D=function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():console.log("Fullscreen API is not supported.")},G={notas:[],nuevaNota:function(a,t){var e={};e.mensaje=a,e.t=Date.now()+5e3,e.color=t?t.color:"gray",this.notas.push(e)},clear:function(){this.notas.splice(0,this.notas.length)}};requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame;var q=null;function V(a){N&&(N.iniciado&&!N.finalizado&&!N.pausado&&a&&(q.innerHTML="Too low resolution, the minimum resolution is "+R+"x"+k+".",q.style.backgroundColor="black"),N.iniciado&&!N.finalizado&&N.pausado&&!a&&(q.innerHTML="",q.style.backgroundColor=""),N.pausado=a)}function H(){pa.fondo.play(),q.style.backgroundColor=""}function U(){q.innerHTML="",pa.fondo.pause(),pa.finalizado.pause(),N.apagar(),q.style.backgroundColor="black",pa.cambiarFondo();var a=[];for(var e in N.jugadores){var i=N.jugadores[e];a.push(new t(i.color,i.controlId,i.secondControlId))}N=new s(a,N.modo,N.maxPlanetas,N.numBolasExtra,N.duracion,N.maxAgujeros,N.agujerosInofensivos,N.bolasXjugador),pa.golpe.play(),setTimeout(H,1e3),N.start()}function W(){q.innerHTML="",pa.finalizado.pause(),N.apagar(),document.getElementById("menu").style.display="",document.getElementById("juego").style.display="none",document.documentElement.style.animation="",X.play()}window.onload=function(){Q.ready=!1,Q.src="img/agujero.png",Q.onload=function(){this.ready=!0},J.invencible.src="img/ico_escudo.png",J.invisible.src="img/ico_ojo.png",J.fortuna.src="img/ico_trebol.png",J.gravedad.src="img/ico_ancla.png",J.salvador.src="img/ico_corazon.png",J.transporte.src="img/ico_rayo.png",J.planetLover.src="img/ico_gravedad.png",T=document.getElementById("mainframe"),O=T.getContext("2d"),B=document.getElementById("backframe"),L=B.getContext("2d"),q=document.getElementById("overscreen"),function(){const a=document.getElementById("addPlayer"),e=document.getElementById("removePlayer"),i=document.getElementById("blackholes"),o=document.getElementById("harmless"),n=document.getElementById("initGame"),r=document.getElementById("time");Y=document.getElementById("mute");const l=document.getElementById("modos"),d=document.getElementById("interfaz"),h=document.getElementById("creditos"),c=document.getElementById("goCredits");X=document.getElementById("sonido");const p=document.getElementById("tabla-jugadores"),v=["1 minute","2 minutes","5 minutes","Infinite time"],g=[1,2,5,-1];var f,m=2,y=-1;const b=document.getElementsByTagName("a");Array.prototype.filter.call(b,function(a){a.onmouseenter=function(){if("1"===Y.getAttribute("data-sound")){const a=pa.pasarBoton;a.play()}},a.onmouseup=function(a){if("1"===Y.getAttribute("data-sound")){const a=pa.clickBoton;a.play()}}});const x=document.getElementsByClassName("btn_start");Array.prototype.filter.call(x,function(a){a.onclick=function(){switch(l.style.display="none",d.style.display="block",r.innerText=v[v.length-1],r.setAttribute("data-time",(v.length-1).toString()),y=g[v.length-1],this.getAttribute("data-modo")){case"Clasico":f=u.CLASICO;break;case"Instinto":f=u.INSTINTO;break;case"Centro":r.innerText=r.innerText=v[0],r.setAttribute("data-time","0"),y=g[0],f=u.CENTRO}}});const w=document.getElementsByClassName("goBack");function M(){4===m?a.classList.add("disabled"):a.classList.remove("disabled"),2===m?e.classList.add("disabled"):e.classList.remove("disabled");for(let a=1;a<=4;++a){const e=a<=m;var t=document.getElementById("player_"+a);e&&"none"===t.style.display&&(t.getElementsByTagName("rect")[0].style.fill=j.shift(),t.style.display=""),e||"none"===t.style.display||(j.push(t.getElementsByTagName("rect")[0].style.fill),t.style.display="none")}}Array.prototype.filter.call(w,function(a){a.onclick=function(){l.style.display="block",d.style.display="none",h.style.display="none",c.style.display="flex"}}),c.onclick=function(){l.style.display="none",d.style.display="none",c.style.display="none",h.style.display="block"},a.onclick=function(){m<4&&++m,M()},e.onclick=function(){m>2&&--m,M()},i.onchange=function(){o.style.display=this.checked?"inline-block":"none"};let I=function(a){a.classList.contains("active")?a.classList.remove("active"):a.classList.add("active")};i.onclick=function(){I(this),this.classList.contains("active")?o.style.display="inline-block":o.style.display="none"},o.onclick=function(){I(this)},r.onclick=function(){let a=parseInt(r.getAttribute("data-time"));a=(a+1)%(v.length-(f===u.CENTRO?1:0)),console.log("to",a),y=g[a],r.setAttribute("data-time",a.toString()),r.innerHTML=v[a]},Y.onclick=function(){ba()};var j=["#7400a0","#009999","#ff0094","#C15616","#000099","#990000","#009900","#bbbb00"];const R=p.getElementsByTagName("rect");Array.prototype.filter.call(R,function(a){if("none"!==a.parentElement.parentElement.parentElement.style.display){var t=Math.floor(Math.random()*j.length);a.style.fill=j.splice(t,1)[0]}a.onclick=function(){j.push(a.style.fill),this.style.fill=j.shift()}}),n.onclick=function(){let a=Math.round(4*Math.random())+2;i.classList.contains("active")||(a=0);let e=o.classList.contains("active");const n=[];for(let a=1;a<=m;a++){const e=document.getElementById("player_"+a),i=e.getElementsByTagName("rect");if(i.length>0){const a=i[0].style.fill,o=e.getElementsByClassName("key")[0].getAttribute("data-keyCode"),r=e.getElementsByClassName("key")[1].getAttribute("data-keyCode");n.push(new t(a,o,r))}}!function(a,t,e,i,o){q.style.backgroundColor="black",document.getElementById("menu").style.display="none",document.getElementById("juego").style.display="block",document.documentElement.style.animation="unset";var n=20+Math.round(5*Math.random())-i,r=Math.round(5*Math.random())+5;N=new s(a,t,n,r,e,i,o),X.pause(),pa.golpe.play(),setTimeout(H,1e3),N.start()}(n,f,y,a,e)}}(),da(window.innerWidth,window.innerHeight)};var X=null,Y=null;var Q=new Image,J={invencible:new Image,invisible:new Image,fortuna:new Image,gravedad:new Image,salvador:new Image,transporte:new Image,planetLover:new Image};for(var K in J)J[K].ready=!1,J[K].onload=function(){this.ready=!0};var Z=0,$={},aa=[],ta=0;function ea(a){var t=a.createRadialGradient(0,0,0,0,0,4);a.save(),a.translate(5,5),a.beginPath(),t.addColorStop(0,"black"),t.addColorStop(1,"white"),a.arc(0,0,5,0,2*Math.PI),a.fillStyle=t,a.fill(),a.closePath(),a.restore()}function ia(a,t,e){a.fillStyle=e,a.rect(0,0,215,215),a.fill(),a.globalCompositeOperation="destination-atop",a.drawImage(t,0,0,215,215)}function oa(a,t,e,i,o){var n=document.createElement("canvas");return n.width=a,n.height=t,e(n.getContext("2d"),i,o),n}var na=function(a){var t=Date.now();if(t>ta&&(ra(),ta=t+166),O.clearRect(0,0,T.width/P.w,T.height/P.h),P.update&&(P.update=!1,O.scale(P.w,P.h)),O.save(),P.dominaAncho&&P.h<1&&O.translate(0,Z),!a.blindGame)for(var e in a.planetas)la(a,a.planetas[e]);for(e in a.asteroides){var i=a.asteroides[e];O.drawImage($.asteroide,.5+i.x-$.asteroide.width/2<<0,.5+i.y-$.asteroide.height/2<<0,.5+$.asteroide.width<<0,.5+$.asteroide.height<<0)}if(!a.blindGame&&Q.ready)for(e in a.agujeros){var o=a.agujeros[e];O.save(),O.translate(o.x,o.y),O.rotate(o.ang),o.ang=(o.ang+.002)%(2*Math.PI),O.drawImage(Q,-o.r,-o.r,2*o.r,2*o.r),O.restore()}for(e in a.bolas){var n=a.bolas[e];if(n.viva){var r;if(n.gravedad)(s=O.createRadialGradient(n.x,n.y,0,n.x,n.y,2*n.r)).addColorStop(0,"rgba(182, 247, 77, 0.4)"),s.addColorStop(1,"rgba(182, 247, 77, 0.1)"),O.beginPath(),O.arc(n.x,n.y,2*n.r,0,2*Math.PI),O.fillStyle=s,O.fill(),O.closePath();if(n.planetLover){var s,l=t%1200/400+1;l=Math.sqrt(l)*n.r,(s=O.createRadialGradient(n.x,n.y,0,n.x,n.y,l)).addColorStop(0,"rgba(140, 0, 0, 0.0)"),s.addColorStop(.7,"rgba(140, 0, 0, 0.0)"),s.addColorStop(1,"rgba(140, 0, 0, 0.8)"),O.beginPath(),O.arc(n.x,n.y,l,0,2*Math.PI),O.fillStyle=s,O.fill(),O.closePath()}if(s=O.createRadialGradient(n.x,n.y,0,n.x,n.y,n.r-1),O.beginPath(),n.salvado?s.addColorStop(0,"#ffff00"):s.addColorStop(0,n.color),n.invisible&&s.addColorStop(.5,"rgba(0,0,0,0)"),n.jugador?s.addColorStop(1,n.jugador.color):s.addColorStop(1,"gray"),n.fortuna&&(r=Math.abs(2e3-n.fortunaTime%4e3)/2e3,n.invencible?O.shadowColor="green":O.shadowColor="rgba(0, 255, 0, "+r+")"),n.invencible&&(!n.fortuna||r<=.5)&&(O.shadowColor="white"),(n.invencible||n.fortuna)&&(O.shadowBlur=10),!n.planeta&&n.transportado){var d=Math.atan2(n.v.y,n.v.x)+Math.PI;O.moveTo(n.x,n.y),O.lineTo(n.x+1.5*n.r*Math.cos(d+Math.PI/4),n.y+1.5*n.r*Math.sin(d+Math.PI/4)),O.lineTo(n.x+1.5*n.r*Math.cos(d+Math.PI),n.y+1.5*n.r*Math.sin(d+Math.PI)),O.lineTo(n.x+1.5*n.r*Math.cos(d-Math.PI/4),n.y+1.5*n.r*Math.sin(d-Math.PI/4)),O.fillStyle=s,O.fill()}else if(O.arc(n.x,n.y,n.r,0,2*Math.PI),O.fillStyle=s,O.fill(),n.jugador&&t-a.inicioPartida>1e3&&t-a.inicioPartida<3e3){O.strokeStyle=n.jugador.color;var h=(3e3-(t-a.inicioPartida))/4e3;O.save(),O.globalAlpha=h*h,O.lineWidth=5,O.beginPath(),O.arc(n.x,n.y,Math.sqrt(100*(t-a.inicioPartida-1e3)),0,2*Math.PI),O.stroke(),O.restore()}O.closePath(),O.shadowBlur=0}}for(e in aa)O.beginPath(),aa[e].color?O.fillStyle=aa[e].color:((s=O.createRadialGradient(aa[e].x,aa[e].y,0,aa[e].x,aa[e].y,4)).addColorStop(0,"#00ff00"),s.addColorStop(1,"#ff00ff"),O.fillStyle=s),O.arc(aa[e].x,aa[e].y,5,0,2*Math.PI),O.fill(),O.closePath();if(a.duracion>0){var u=Math.round(30*a.duracion-(t-a.inicioPartida)/2e3);if(u>=0&&u<10){var c=6e4*a.duracion-(t-a.inicioPartida);for(c%=2e3,c=(Math.sin(c/1e3*Math.PI+Math.PI/4)+1)/2,e=1;e<=u;e++)O.beginPath(),O.rect(C.w/2-200+4*e+19*(e-1),C.h-40,19,36),O.fillStyle="rgba(200,0,0,"+c+")",O.fill(),O.closePath()}}O.restore()};function ra(){if(L.clearRect(0,0,B.width/P.w,B.height/P.h),P.update2&&(P.update2=!1,L.scale(P.w,P.h)),L.save(),P.dominaAncho&&P.h<1&&L.translate(0,Z),!N.blindGame)for(var a in N.planetas)sa(N.planetas[a]);L.restore(),L.save(),L.font="bold 20px Orbitron",L.shadowColor="#471468",L.shadowOffsetX=0,L.shadowOffsetY=0,L.shadowBlur=10;var t=L.createLinearGradient(0,0,200,0);t.addColorStop(.25,"gray"),t.addColorStop(.75,"white"),L.fillStyle=t;var e=L.measureText(N.modo).width;if(L.fillText(N.modo,C.w-e-20,40),L.restore(),S){var i=["FPS: "+A,"min: "+E];for(L.save(),L.font='bold 30px "Courier New"',L.fillStyle="red",a=0;a<i.length;a++){var o=i[a];if(o.length<10)for(var n=0;n<10-o.length;n++)o+=" ";var r=L.measureText(o).width;L.save(),L.fillText(o,C.w-r-e,40),L.restore(),L.translate(0,30)}L.restore()}!function(a){var t=[];for(var e in a.jugadores)t[e]={};for(e in a.bolas){var i=a.bolas[e];if(i.jugador){var o=t[a.jugadores.indexOf(a.bolas[e].jugador)];o.invencible=o.invencible||i.invencible,o.invisible=o.invisible||i.invisible,o.fortuna=o.fortuna||i.fortuna,o.gravedad=o.gravedad||i.gravedad,o.salvador=o.salvador||i.salvado,o.transporte=o.transporte||i.transportado,o.planetLover=o.planetLover||i.planetLover}}var n=[];for(e in t){var r=t[e];r.invencible&&n.push($.paletaIconos[e].invencible),r.invisible&&n.push($.paletaIconos[e].invisible),r.fortuna&&n.push($.paletaIconos[e].fortuna),r.gravedad&&n.push($.paletaIconos[e].gravedad),r.transporte&&n.push($.paletaIconos[e].transporte),r.salvador&&n.push($.paletaIconos[e].salvador),r.planetLover&&n.push($.paletaIconos[e].planetLover)}var s=B.width/24,l=.8*s,d=.1*s,h=n.length*s,u=(B.width-h)/2;for(e in L.save(),L.shadowColor="#471468",L.shadowOffsetX=0,L.shadowOffsetY=0,L.shadowBlur=10,L.scale(1/P.w,1/P.h),L.translate(u,B.height-s),n)L.translate(d,0),L.drawImage(n[e],0,0,l,l),L.translate(l+d,0);L.restore()}(N),L.save();L.font="bold 20px Orbitron";for(a in L.shadowColor="#471468",L.shadowOffsetX=0,L.shadowOffsetY=0,L.shadowBlur=10,G.notas)L.fillStyle=G.notas[a].color,L.fillText(G.notas[a].mensaje,20,40+20*a*1.2);L.restore()}function sa(a){if(a.renderizado&&a.rotar(),!(a.centro||a.inquieto||a.radioVariable)){var t=L.createRadialGradient(a.x,a.y,0,a.x,a.y,a.rg);a.nodisponible?(t.addColorStop(0,"rgba(80, 80, 80, 0.4)"),t.addColorStop(1,"rgba(80, 80, 80, 0.1)")):(t.addColorStop(0,"rgba(90, 45, 180, 0.2)"),t.addColorStop(1,"rgba(90, 45, 180, 0.1)")),L.beginPath(),L.arc(a.x,a.y,a.rg,0,2*Math.PI),L.fillStyle=t,L.fill(),L.closePath(),a.renderizado?L.drawImage(a.renderizado,a.x-(.5+a.r<<0),a.y-(.5+a.r<<0)):(L.beginPath(),L.arc(a.x,a.y,a.r,0,2*Math.PI),L.fillStyle="#4A392C",L.fill(),L.closePath())}}function la(a,t){if(t.centro||t.inquieto||t.radioVariable){if(t.centro){var e=O.createRadialGradient(t.x,t.y,0,t.x,t.y,t.rg);if(null!==t.mayor_t_j){var i=0;for(var o in a.jugadores)a.jugadores[o]!==t.mayor_t_j&&a.jugadores[o].tiempo>i&&(i=a.jugadores[o].tiempo);e.addColorStop(.7*Math.min(t.mayor_t-i,30)/30+.2,t.mayor_t_j.color)}else e.addColorStop(0,"rgba(80, 200, 80, 0.2)");e.addColorStop(1,"rgba(80, 200, 80, 0.1)")}else t.inquieto?((e=O.createRadialGradient(t.x,t.y,0,t.x,t.y,t.rg)).addColorStop(0,"rgba(255, 255, 255, 0.4)"),e.addColorStop(1,"rgba(0, 0, 0, 0.1)")):t.radioVariable&&((e=O.createRadialGradient(t.x,t.y,0,t.x,t.y,t.rg)).addColorStop(0,"rgba(200, 45, 180, 0.2)"),e.addColorStop(1,"rgba(200, 45, 180, 0.1)"));O.beginPath(),O.arc(t.x,t.y,t.rg,0,2*Math.PI),O.fillStyle=e,O.fill(),O.closePath(),t.renderizado?O.drawImage(t.renderizado,t.x-(.5+t.r<<0),t.y-(.5+t.r<<0)):(O.beginPath(),O.arc(t.x,t.y,t.r,0,2*Math.PI),O.fillStyle="#4A392C",O.fill(),O.closePath())}}function da(a,t){if(a<R||t<k)V(!0);else{V(!1),T.width=a,B.width=a,T.height=t,B.height=t;var e=a/C.w,i=t/C.h;P={w:e>i?i:e,h:i>=e?e:i,dominaAncho:i>=e,update:!0,update2:!0},Z=.5*(T.height-P.h*C.h)/P.h}}function ha(a,t,e){if(a.x===t.x&&a.y===t.y)return ca(a.x-e.x,a.y-e.y);var i=((e.x-a.x)*(t.x-a.x)+(e.y-a.y)*(t.y-a.y))/(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2));if(i<0)return ca(a.x-e.x,a.y-e.y);if(i>1)return ca(t.x-e.x,t.y-e.y);var o=[a.x+i*(t.x-a.x),a.y+i*(t.y-a.y)];return ca(o[0]-e.x,o[1]-e.y)}function ua(a){return a<0?-1:1}function ca(a,t){return Math.sqrt(a*a+t*t)}window.onresize=function(){da(window.innerWidth,window.innerHeight)};var pa={},va=new Audio,ga=".ogg";va.canPlayType&&va.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,"")||(ga=".mp3"),pa.pong=new Audio("snd/pong"+ga),pa.pong.volume=1,pa.pong2=new Audio("snd/pong2"+ga),pa.pong2.volume=.9,pa.entrada=new Audio("snd/entrada"+ga),pa.entrada.volume=.9,pa.claxon=new Audio("snd/claxon"+ga),pa.claxon.volume=.7,pa.cambio=new Audio("snd/cambioOrbita"+ga),pa.cambio.volume=.6,pa.muerte=new Audio("snd/muerte"+ga),pa.muerte.volume=.9,pa.cinta=new Audio("snd/cinta"+ga),pa.cinta.volume=.8,pa.golpe=new Audio("snd/golpe"+ga),pa.golpe.volume=.8,pa.dados=new Audio("snd/dados"+ga),pa.dados.volume=.8,pa.pasarBoton=new Audio("snd/pasarBoton"+ga),pa.pasarBoton.volume=.2,pa.clickBoton=new Audio("snd/clickBoton.ogg"),pa.clickBoton.volume=.3,pa.finalizado=new Audio("snd/beat_culture_julien"+ga),pa.finalizado.volume=.3;var fa=[new Audio("snd/Jay_Krewel_Break_The_Rules"+ga),new Audio("snd/Space And Time"+ga),new Audio("snd/Zythian_Bring_It_Back"+ga)];function ma(a){a.currentTime=0,a.play()}pa.cambiarFondo=function(){pa.fondo=fa[Math.floor(Math.random()*fa.length)],pa.fondo.currentTime=0,pa.fondo.volume=.3,pa.fondo.loop=!0},pa.cambiarFondo();var ya=!1;function ba(){for(var a in ya=!ya,pa)pa[a].muted=ya;for(a in fa)fa[a].muted=ya;X.muted=ya,Y&&(Y.innerHTML=ya?"🔈":"🔊")}}();
